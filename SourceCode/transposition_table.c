/*-------------------------------------------------------------------------------
** Light Rider - Transposition table
**-----------------------------------------------------------------------------*/

#include "definitions.h"

extern GAME_STATE game_state;

static const uint64_t		tile_keys[4][64] =
{ {
        ((uint64_t)0x16E520815D81299F), ((uint64_t)0x27EF3721E729673D), ((uint64_t)0x62366C6B3D83DB1B), ((uint64_t)0x2BCF0C4D85A9F9E5),
        ((uint64_t)0x68964A06F8A04041), ((uint64_t)0x9BFE7C1D6A8FE213), ((uint64_t)0x61623E6FF53479DF), ((uint64_t)0x82FA3B9E8E751D9D),
        ((uint64_t)0x0B4B9C4580C73CC0), ((uint64_t)0x9EF3A09D63C28081), ((uint64_t)0x37AA02293ECBBEAE), ((uint64_t)0x8F23FCA1D76FFD37),
        ((uint64_t)0x5F175F622E9F3A9A), ((uint64_t)0x64272B93BD58F152), ((uint64_t)0xD466A89787761783), ((uint64_t)0x34734D49B345A448),
        ((uint64_t)0x16D7C964A7113ED0), ((uint64_t)0xC72295E50D71F6A2), ((uint64_t)0xBB67FAD753240231), ((uint64_t)0x5AB213DB27EBB9DD),
        ((uint64_t)0xA96F8EBC9D94E656), ((uint64_t)0xDCFEE02DA9DDDDC0), ((uint64_t)0xEA4107ECE0AA8EED), ((uint64_t)0x0FB06957CA581DFF),
        ((uint64_t)0x3045B4970AA431CA), ((uint64_t)0x8A6BD00E61E8B355), ((uint64_t)0x621D44E21705322B), ((uint64_t)0xBC8EA1F5F0DECD7E),
        ((uint64_t)0xF38E9A01E84E226A), ((uint64_t)0xE4DD0610E7C4D7C4), ((uint64_t)0x8A9C7C333DB9B9AC), ((uint64_t)0x68702CA9D62ACFED),
        ((uint64_t)0x8CDCDCE206E71C41), ((uint64_t)0x1D61ED17139357D1), ((uint64_t)0xFA37798B625878D5), ((uint64_t)0x0B1572BF66D633E9),
        ((uint64_t)0x1078AFB92BDC41A2), ((uint64_t)0xEBA3745C4A0EAD86), ((uint64_t)0x18ACAED2AD1E0043), ((uint64_t)0xC9DF5081D3A75D9F),
        ((uint64_t)0x8601A5388CA3BBD8), ((uint64_t)0xC78A5506F0D6CD53), ((uint64_t)0x67F49F8986B8749D), ((uint64_t)0x11B88FF662682B8E),
        ((uint64_t)0xF0D666A7D7D0A51D), ((uint64_t)0x480E5447FA572376), ((uint64_t)0x483E0F78112458AA), ((uint64_t)0x18695EA31761358A),
        ((uint64_t)0xC0C53A199E4407C9), ((uint64_t)0x35AC430DB353E59B), ((uint64_t)0xE37321A895B2DEA4), ((uint64_t)0xC7D0A76A3174AA03),
        ((uint64_t)0xFB84CD6F8E7FA6CC), ((uint64_t)0xD704AC441C125CC5), ((uint64_t)0xE4C544B62A2A94CD), ((uint64_t)0x5D88297152D60D85),
        ((uint64_t)0x4774CB315416835F), ((uint64_t)0x462212A537238B6D), ((uint64_t)0xF8C239692F080140), ((uint64_t)0x516D351B90666080),
        ((uint64_t)0x9825CE2F8D3FD3F7), ((uint64_t)0x94E7AF1AD7CF53EA), ((uint64_t)0x0A6FD0A3E8E2010B), ((uint64_t)0xED94481181ACEF4A) },
        { ((uint64_t)0x152A58F9E889607C), ((uint64_t)0x2F2810AF5A1A8312), ((uint64_t)0x69F12DA056E9FE7B), ((uint64_t)0x2A23B15BCB715063),
        ((uint64_t)0x9BAF26235CA877B8), ((uint64_t)0xC0E34F0ECE76631F), ((uint64_t)0x0133097D088D52B8), ((uint64_t)0x5794D68A7EF654FA),
        ((uint64_t)0xB35C1658CC6CF213), ((uint64_t)0x2F2D90978305BAD4), ((uint64_t)0x03202519543A6693), ((uint64_t)0xF9E022EDC7D3EFAD),
        ((uint64_t)0x16FBD14408D3757E), ((uint64_t)0xEA3DB4FBF48ADCE1), ((uint64_t)0x89DDA6437140669C), ((uint64_t)0x6F0F19E2026ED596),
        ((uint64_t)0xC96D1E4203356EAE), ((uint64_t)0xF723E57250EDAB85), ((uint64_t)0x308FAD33D6D01E78), ((uint64_t)0xB3B5B524F515DD83),
        ((uint64_t)0x575AC9E7A19D738C), ((uint64_t)0xC7A7DB76D5693473), ((uint64_t)0x5D261F5CA221CF72), ((uint64_t)0x3FD6C840C5BAE186),
        ((uint64_t)0x3E3CBD56073782EA), ((uint64_t)0x7ECF5F1CB253C8F8), ((uint64_t)0x56B0B48465B29651), ((uint64_t)0x9EAD5205A64AA6AF),
        ((uint64_t)0xE91FBC60C2E45578), ((uint64_t)0x488D0DEDBE88B65C), ((uint64_t)0x9CBBC33423AAB46A), ((uint64_t)0x2BDED51011AA0F15),
        ((uint64_t)0x3BB6AF8235EA33F6), ((uint64_t)0xC3166B5CE4738286), ((uint64_t)0x2C34B974555BCFF7), ((uint64_t)0x0896A065534D9A1C),
        ((uint64_t)0x8C32CE9FA4C806AC), ((uint64_t)0xC0630BC692BA50E4), ((uint64_t)0xA6567ED9C1E57FA7), ((uint64_t)0xA307E119B375F6F3),
        ((uint64_t)0x2463B1A044269218), ((uint64_t)0x3E523B021A83D38B), ((uint64_t)0xA61DCCE285F63578), ((uint64_t)0xB2D8060A82062D5D),
        ((uint64_t)0x4AA09BD0F3EA94E8), ((uint64_t)0xCBFA2F81C567EC9B), ((uint64_t)0x18C65AA30EAE5CC2), ((uint64_t)0xA4F16EA85A0120B3),
        ((uint64_t)0xAAF84718BA67BB28), ((uint64_t)0x8A9E4B050CF3E3E6), ((uint64_t)0x15CE68C2E9A03F95), ((uint64_t)0xA93E0DCD57A37127),
        ((uint64_t)0x712A23FEB1B09ABD), ((uint64_t)0x00CD79D87DD6D4D2), ((uint64_t)0xBB042ACA2BF40745), ((uint64_t)0x2CC999A89B1A7F4B),
        ((uint64_t)0xBBE6337EF90B2D13), ((uint64_t)0x9E28B1A6F0ACB87D), ((uint64_t)0xE919BABDD2A96C44), ((uint64_t)0xF2CC11B5D1E015D2),
        ((uint64_t)0x89D56FAF9C7FFA13), ((uint64_t)0x7651E0DB62663020), ((uint64_t)0xB541540DDDF7E931), ((uint64_t)0x771C93C720B77D96) },
        { ((uint64_t)0x68EB0834C48F6859), ((uint64_t)0x61820F91565373B7), ((uint64_t)0xCC52E2D0C9D2852F), ((uint64_t)0x1C8B891D6840FFDC),
        ((uint64_t)0x587C6787A00066A5), ((uint64_t)0x7947A315CBCE08DF), ((uint64_t)0x6BF78452A58A8979), ((uint64_t)0x41A56491FE3A1AD5),
        ((uint64_t)0x36A1660919D5628F), ((uint64_t)0x8FED64F87184A600), ((uint64_t)0xCE5E65EF2C903633), ((uint64_t)0xDE5CFACED553EC66),
        ((uint64_t)0xF95D9FE80D5BC080), ((uint64_t)0x7908FEABE06265AC), ((uint64_t)0x6CF91F416252CA84), ((uint64_t)0x451DAD986DAD9729),
        ((uint64_t)0xDC1012D68A6048DE), ((uint64_t)0x71B06AB808192E48), ((uint64_t)0x16C0749FD34773E2), ((uint64_t)0x09C6B32587F0A5B4),
        ((uint64_t)0xA1AC588E5B7E3E88), ((uint64_t)0x2EDA6C79D74EF1EB), ((uint64_t)0x8E80BEE8BD05F8AE), ((uint64_t)0x990D328A3508301B),
        ((uint64_t)0x143A6325E0951282), ((uint64_t)0x10632F758962AA84), ((uint64_t)0x3DAE259FBF8F3202), ((uint64_t)0xE2C65E2E7C7B47B2),
        ((uint64_t)0xE2201035AF56E8F2), ((uint64_t)0xBF3B9F35E3DAB640), ((uint64_t)0xE041885B19ACA8C8), ((uint64_t)0x819A655873686D15),
        ((uint64_t)0x31B077CC8BFB634C), ((uint64_t)0xA54018BF0D6CF82B), ((uint64_t)0xD61CE48092726A0C), ((uint64_t)0xE29F45C67E1E146A),
        ((uint64_t)0x9B850C35EC1463CB), ((uint64_t)0x3536468E88A76117), ((uint64_t)0xDE77B45151E1E694), ((uint64_t)0xA75A76555656FBE6),
        ((uint64_t)0x941E6F8CD57BBE21), ((uint64_t)0x7174482C7C3CC4BB), ((uint64_t)0xE9D31448CAABF1AE), ((uint64_t)0xB4ABF3BC5010D88F),
        ((uint64_t)0xB54BF4238B690970), ((uint64_t)0x57AEB64B92EE1F1D), ((uint64_t)0x06F70BC87711B349), ((uint64_t)0xC9208853F7081D41),
        ((uint64_t)0xDFDD4CB65BA18779), ((uint64_t)0x206F647D1D132E32), ((uint64_t)0xB776A6144AE8A149), ((uint64_t)0x5D2CD7EFBED2DFF5),
        ((uint64_t)0x8619E1713DC9D513), ((uint64_t)0xB8B3D16E3DC503C4), ((uint64_t)0x303C98A21CBAD415), ((uint64_t)0x07CEC8C7DF98A13E),
        ((uint64_t)0xF7826EC516D9D7E0), ((uint64_t)0x943386BACDA9F395), ((uint64_t)0xC29F23B3E8094A73), ((uint64_t)0xFA193271196EFA16),
        ((uint64_t)0x9E58630D52AC1D3D), ((uint64_t)0x6ECEF94F7D5A81C3), ((uint64_t)0x927D6A462AAE7096), ((uint64_t)0xBC258BE6785073D8) },
        { ((uint64_t)0x176FA00325B31E78), ((uint64_t)0xFBA54B582173B56C), ((uint64_t)0xA5E3CE4CFF5EFE76), ((uint64_t)0xEDEEE1A1D2B90E8E),
        ((uint64_t)0xB4C5D503E8C81E46), ((uint64_t)0xA853C0C2B2387393), ((uint64_t)0x72B78E40774D8160), ((uint64_t)0x5693ECC59CE0396E),
        ((uint64_t)0x93639726211F1375), ((uint64_t)0x92DB874FE8DFC644), ((uint64_t)0x86EC90FA14ECA4CF), ((uint64_t)0x0481F454CA90C1A0),
        ((uint64_t)0xE504AC1DE657D4DF), ((uint64_t)0xF8B0A333447F33F4), ((uint64_t)0x7FC11CE1E9CE8E7B), ((uint64_t)0xC907317C99A3FB43),
        ((uint64_t)0x3608ECF1F8B0FA9F), ((uint64_t)0x2D70214660948B2C), ((uint64_t)0x7C82276B39A961B0), ((uint64_t)0x21CD3FED7F1CA8B0),
        ((uint64_t)0x802C1580F957A889), ((uint64_t)0x2FBEBFC6A72DC666), ((uint64_t)0x6158D9E0E4773DE2), ((uint64_t)0x1ABB734350E063FE),
        ((uint64_t)0xC28705D696DCB5D4), ((uint64_t)0x8ACF0EA8C8B56C38), ((uint64_t)0x069D988479BB4C7F), ((uint64_t)0x9AC1BA80260F8EC7),
        ((uint64_t)0x0F57AA505FC4E61A), ((uint64_t)0x1B10D879C35A0FB1), ((uint64_t)0x6935E8F8B6DFB205), ((uint64_t)0x860AEA92C8048C2A),
        ((uint64_t)0x8811EF920D3AA784), ((uint64_t)0xD486D4CE241CD501), ((uint64_t)0xE878450012BC7654), ((uint64_t)0xA81758F26DE6C912),
        ((uint64_t)0x3837B74BF7E00A3F), ((uint64_t)0x314535440B759E5D), ((uint64_t)0xC618768958333847), ((uint64_t)0xC03EDF451CEAD6B6),
        ((uint64_t)0xD779F2CE48C36533), ((uint64_t)0x76986E14DFA14523), ((uint64_t)0x149C2A0C71F8407F), ((uint64_t)0x231C311AE7279B62),
        ((uint64_t)0x23A0B870586BDBF5), ((uint64_t)0xE753EB35368A033A), ((uint64_t)0x38D85437E96E4780), ((uint64_t)0xAB5E9CB523155D76),
        ((uint64_t)0x6ABBF8C2CE1139FB), ((uint64_t)0x01C7B305A15270BD), ((uint64_t)0xDAF417ED7AAC0300), ((uint64_t)0xFC84FFE0D5A2ACAD),
        ((uint64_t)0x261BC897B0EB570F), ((uint64_t)0xEFDFE795637D39DA), ((uint64_t)0x7B76698EBF9ECE7C), ((uint64_t)0x11FFE9DF28F26DA1),
        ((uint64_t)0x1E9144D47DA27907), ((uint64_t)0x67EA8771BFB9F0F5), ((uint64_t)0x88DABC9B5448830D), ((uint64_t)0x5D3CD35D69B20B8C),
        ((uint64_t)0xBA76C518F1E4E6B3), ((uint64_t)0x54867F07244D2112), ((uint64_t)0xBA2C389CF625D27B), ((uint64_t)0x8D17857FE5181451) }
};

uint64_t turn_key[2] = { ((uint64_t)0x50DAC80A753049B4), ((uint64_t)0xD2203D893B0399E6) };

uint64_t zkey_value(int index) 
{
    assert(index >= 0 && index < FIELD_SIZE);

    if (game_state.field[index] == EMPTY)   return tile_keys[0][index];
    if (game_state.field[index] == WALL)    return tile_keys[1][index];
    if (game_state.field[index] == PLAYER0) return tile_keys[2][index];
    if (game_state.field[index] == PLAYER1) return tile_keys[3][index];

    fprintf(stderr, "wrong item at %d: %c\n", index, game_state.field[index]);

    return 0;
}

uint64_t zkey_turn(int turn)
{
    return turn_key[turn];
}

uint64_t calc_zkey(int turn)
{
    uint64_t zkey = 0;
    int	i;

    for (i = 0; i < FIELD_SIZE; i++)
        zkey ^= zkey_value(i);

    zkey ^= turn_key[turn];
    
    return zkey;
}

// END